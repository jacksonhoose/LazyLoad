(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.offset = offset;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var DEFAULT_ATTRIBUTE = 'data-lazy-load';
var DEFAULT_SELECTOR = '[' + DEFAULT_ATTRIBUTE + ']';

function offset(el) {
    var top = 0;
    var left = 0;

    while (el) {
        left += el.offsetLeft;
        top += el.offsetTop;
        el = el.offsetParent;
    }

    return { left: left, top: top };
};

var LazyLoad = (function () {
    function LazyLoad() {
        var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _classCallCheck(this, LazyLoad);

        var _options$selector = options.selector;
        var selector = _options$selector === undefined ? DEFAULT_SELECTOR : _options$selector;
        var _options$onImageLoade = options.onImageLoaded;
        var onImageLoaded = _options$onImageLoade === undefined ? function () {} : _options$onImageLoade;
        var _options$onScrollToIm = options.onScrollToImage;
        var onScrollToImage = _options$onScrollToIm === undefined ? function () {} : _options$onScrollToIm;
        var delay = options.delay;

        Object.assign(this, {
            _delay: delay,
            _selector: selector,
            _images: Array.from(document.querySelectorAll(selector)),

            /**
             * Called when the image is loaded.
             * @type {Function}
             */
            _onImageLoaded: onImageLoaded,

            /**
             * Called when the image comes into the view port.
             * @type {Function}
             */
            _onScrollToImage: onScrollToImage,

            _distances: null,
            _distanceScrolled: 0,
            _doc: window.document,
            _window: window
        });

        this._getAllElementOffsets();

        this._onScrollHandler = this._onScrollHandler.bind(this);
        this._onResizeHandler = this._onResizeHandler.bind(this);

        this._attachEvents();
    }

    _createClass(LazyLoad, [{
        key: '_onResizeHandler',
        value: function _onResizeHandler(e) {
            return this._getAllElementOffsets(e) && this._onScrollHandler(e);
        }
    }, {
        key: '_onScrollHandler',
        value: function _onScrollHandler(e) {
            console.log('scroll');
            return this._scrollResizeHandler(e) && this._maybeRevealElements();
        }
    }, {
        key: '_attachEvents',
        value: function _attachEvents() {
            this._doc.addEventListener('scroll', this._onScrollHandler);
            this._doc.addEventListener('resize', this._onResizeHandler);
        }
    }, {
        key: '_getOffsetTop',
        value: function _getOffsetTop(document, element) {
            var box = element.getBoundingClientRect();
            return box.top + document.scrollY;
        }
    }, {
        key: '_loadImage',
        value: function _loadImage(image) {
            var _this = this;

            // Return early if the image is already loading.
            var imageInfo = this._distances.get(image);
            if (!image || imageInfo && imageInfo.isLoading) return;

            var loadedCallback = function loadedCallback(e) {
                image.removeEventListener('load', loadedCallback);
                _this._distances.delete(image);
                _this._onImageLoaded(image);

                if (_this._distances.length === 0) _this.destroy();
            };
            image.addEventListener('load', loadedCallback);
            image.setAttribute('src', image.getAttribute(DEFAULT_ATTRIBUTE));

            // Set the image as loading.
            this._distances.set(image, Object.assign({}, this._distances.get(image), { isLoading: true }));
            // Call scroll to callback.
            this._onScrollToImage(image);
        }
    }, {
        key: '_maybeRevealElements',
        value: function _maybeRevealElements(e) {
            var _this2 = this;

            Array.from(this._distances.keys()).forEach(function (image) {
                return _this2._distanceScrolled >= _this2._distances.get(image).offsetTop && _this2._loadImage(image);
            });
        }
    }, {
        key: '_getAllElementOffsets',
        value: function _getAllElementOffsets() {
            this._distances = this._images.reduce(function (images, image) {

                if (images.has(image) && !images.get(image).isLoading) return images;

                images.set(image, {
                    offsetTop: offset(image).top,
                    isLoading: false,
                    timeOut: null
                });

                return images;
            }, this._distances || new Map());
            return true;
        }
    }, {
        key: '_getScrolledHeight',
        value: function _getScrolledHeight() {
            return window.innerHeight + window.scrollY;
        }
    }, {
        key: '_scrollResizeHandler',
        value: function _scrollResizeHandler(e) {
            var distance = this._getScrolledHeight();

            if (distance <= this._distanceScrolled) return;

            this._distanceScrolled = distance;

            return true;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._doc.removeEventListener('scroll', this._onScrollHandler);
            this._doc.removeEventListener('resize', this._onResizeHandler);
        }
    }]);

    return LazyLoad;
})();

exports.default = LazyLoad;

},{}],2:[function(require,module,exports){
'use strict';

var _src = require('../src');

var _src2 = _interopRequireDefault(_src);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

document.addEventListener('DOMContentLoaded', function (e) {
    var lazy = new _src2.default();
});

},{"../src":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXguanMiLCJ0ZXN0L2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7OztRQ0dnQixNQUFNLEdBQU4sTUFBTTs7OztBQUh0QixJQUFNLGlCQUFpQixHQUFHLGdCQUFnQixDQUFDO0FBQzNDLElBQU0sZ0JBQWdCLFNBQU8saUJBQWlCLE1BQUcsQ0FBQzs7QUFFM0MsU0FBUyxNQUFNLENBQUMsRUFBRSxFQUFDO0FBQ3RCLFFBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNaLFFBQUksSUFBSSxHQUFHLENBQUMsQ0FBQzs7QUFFYixXQUFNLEVBQUUsRUFBQztBQUNMLFlBQUksSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDO0FBQ3RCLFdBQUcsSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDO0FBQ3BCLFVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDO0tBQ3hCOztBQUVELFdBQU8sRUFBQyxJQUFJLEVBQUosSUFBSSxFQUFFLEdBQUcsRUFBSCxHQUFHLEVBQUMsQ0FBQztDQUN0QixDQUFDOztJQUVtQixRQUFRO0FBQ3pCLGFBRGlCLFFBQVEsR0FDQTtZQUFiLE9BQU8seURBQUcsRUFBRTs7OEJBRFAsUUFBUTs7Z0NBT2pCLE9BQU8sQ0FKUCxRQUFRO1lBQVIsUUFBUSxxQ0FBRyxnQkFBZ0I7b0NBSTNCLE9BQU8sQ0FIUCxhQUFhO1lBQWIsYUFBYSx5Q0FBRyxZQUFNLEVBQUU7b0NBR3hCLE9BQU8sQ0FGUCxlQUFlO1lBQWYsZUFBZSx5Q0FBRyxZQUFNLEVBQUU7WUFDMUIsS0FBSyxHQUNMLE9BQU8sQ0FEUCxLQUFLOztBQUdULGNBQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO0FBQ2hCLGtCQUFNLEVBQUUsS0FBSztBQUNiLHFCQUFTLEVBQUUsUUFBUTtBQUNuQixtQkFBTyxFQUFFLEtBQUssQ0FBQyxJ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SSxDQUFDO1NBQ2Y7OztrQ0FFUTtBQUNMLGdCQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUMvRCxnQkFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDbEU7OztXQXhIZ0IsUUFBUTs7O2tCQUFSLFFBQVE7Ozs7Ozs7Ozs7O0FDZDdCLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxVQUFBLENBQUMsRUFBSTtBQUMvQyxRQUFJLElBQUksR0FBRyxtQkFBYyxDQUFDO0NBQzdCLENBQUMsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjb25zdCBERUZBVUxUX0FUVFJJQlVURSA9ICdkYXRhLWxhenktbG9hZCc7XG5jb25zdCBERUZBVUxUX1NFTEVDVE9SID0gYFske0RFRkFVTFRfQVRUUklCVVRFfV1gO1xuXG5leHBvcnQgZnVuY3Rpb24gb2Zmc2V0KGVsKXtcbiAgICBsZXQgdG9wID0gMDtcbiAgICBsZXQgbGVmdCA9IDA7XG5cbiAgICB3aGlsZShlbCl7XG4gICAgICAgIGxlZnQgKz0gZWwub2Zmc2V0TGVmdDtcbiAgICAgICAgdG9wICs9IGVsLm9mZnNldFRvcDtcbiAgICAgICAgZWwgPSBlbC5vZmZzZXRQYXJlbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtsZWZ0LCB0b3B9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGF6eUxvYWQge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSl7XG4gICAgICAgIGxldCB7XG4gICAgICAgICAgICBzZWxlY3RvciA9IERFRkFVTFRfU0VMRUNUT1IsXG4gICAgICAgICAgICBvbkltYWdlTG9hZGVkID0gKCkgPT4ge30sXG4gICAgICAgICAgICBvblNjcm9sbFRvSW1hZ2UgPSAoKSA9PiB7fSxcbiAgICAgICAgICAgIGRlbGF5XG4gICAgICAgIH0gPSBvcHRpb25zO1xuXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywge1xuICAgICAgICAgICAgX2RlbGF5OiBkZWxheSxcbiAgICAgICAgICAgIF9zZWxlY3Rvcjogc2VsZWN0b3IsXG4gICAgICAgICAgICBfaW1hZ2VzOiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKSxcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDYWxsZWQgd2hlbiB0aGUgaW1hZ2UgaXMgbG9hZGVkLlxuICAgICAgICAgICAgICogQHR5cGUge0Z1bmN0aW9ufVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBfb25JbWFnZUxvYWRlZDogb25JbWFnZUxvYWRlZCxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDYWxsZWQgd2hlbiB0aGUgaW1hZ2UgY29tZXMgaW50byB0aGUgdmlldyBwb3J0LlxuICAgICAgICAgICAgICogQHR5cGUge0Z1bmN0aW9ufVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBfb25TY3JvbGxUb0ltYWdlOiBvblNjcm9sbFRvSW1hZ2UsXG5cbiAgICAgICAgICAgIF9kaXN0YW5jZXM6IG51bGwsXG4gICAgICAgICAgICBfZGlzdGFuY2VTY3JvbGxlZDogMCxcbiAgICAgICAgICAgIF9kb2M6IHdpbmRvdy5kb2N1bWVudCxcbiAgICAgICAgICAgIF93aW5kb3c6IHdpbmRvdyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fZ2V0QWxsRWxlbWVudE9mZnNldHMoKTtcblxuICAgICAgICB0aGlzLl9vblNjcm9sbEhhbmRsZXIgPSB0aGlzLl9vblNjcm9sbEhhbmRsZXIuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fb25SZXNpemVIYW5kbGVyID0gdGhpcy5fb25SZXNpemVIYW5kbGVyLmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5fYXR0YWNoRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgX29uUmVzaXplSGFuZGxlcihlKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEFsbEVsZW1lbnRPZmZzZXRzKGUpICYmIHRoaXMuX29uU2Nyb2xsSGFuZGxlcihlKTtcbiAgICB9XG5cbiAgICBfb25TY3JvbGxIYW5kbGVyKGUpe1xuICAgICAgICBjb25zb2xlLmxvZygnc2Nyb2xsJylcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Njcm9sbFJlc2l6ZUhhbmRsZXIoZSkgJiYgdGhpcy5fbWF5YmVSZXZlYWxFbGVtZW50cygpO1xuICAgIH1cblxuICAgIF9hdHRhY2hFdmVudHMoKXtcbiAgICAgICAgdGhpcy5fZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuX29uU2Nyb2xsSGFuZGxlcik7XG4gICAgICAgIHRoaXMuX2RvYy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9vblJlc2l6ZUhhbmRsZXIpO1xuICAgIH1cblxuICAgIF9nZXRPZmZzZXRUb3AoZG9jdW1lbnQsIGVsZW1lbnQpe1xuICAgICAgICBsZXQgYm94ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgcmV0dXJuIGJveC50b3AgKyBkb2N1bWVudC5zY3JvbGxZO1xuICAgIH1cblxuICAgIF9sb2FkSW1hZ2UoaW1hZ2Upe1xuICAgICAgICAvLyBSZXR1cm4gZWFybHkgaWYgdGhlIGltYWdlIGlzIGFscmVhZHkgbG9hZGluZy5cbiAgICAgICAgbGV0IGltYWdlSW5mbyA9IHRoaXMuX2Rpc3RhbmNlcy5nZXQoaW1hZ2UpO1xuICAgICAgICBpZiAoIWltYWdlIHx8IChpbWFnZUluZm8gJiYgaW1hZ2VJbmZvLmlzTG9hZGluZykpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgbGV0IGxvYWRlZENhbGxiYWNrID0gZSA9PiB7XG4gICAgICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgbG9hZGVkQ2FsbGJhY2spO1xuICAgICAgICAgICAgdGhpcy5fZGlzdGFuY2VzLmRlbGV0ZShpbWFnZSk7XG4gICAgICAgICAgICB0aGlzLl9vbkltYWdlTG9hZGVkKGltYWdlKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc3RhbmNlcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgICAgIH07XG4gICAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkZWRDYWxsYmFjayk7XG4gICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1hZ2UuZ2V0QXR0cmlidXRlKERFRkFVTFRfQVRUUklCVVRFKSk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBpbWFnZSBhcyBsb2FkaW5nLlxuICAgICAgICB0aGlzLl9kaXN0YW5jZXMuc2V0KGltYWdlLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9kaXN0YW5jZXMuZ2V0KGltYWdlKSwge2lzTG9hZGluZzogdHJ1ZX0pKTtcbiAgICAgICAgLy8gQ2FsbCBzY3JvbGwgdG8gY2FsbGJhY2suXG4gICAgICAgIHRoaXMuX29uU2Nyb2xsVG9JbWFnZShpbWFnZSk7XG4gICAgfVxuXG4gICAgX21heWJlUmV2ZWFsRWxlbWVudHMoZSl7XG4gICAgICAgIEFycmF5LmZyb20odGhpcy5fZGlzdGFuY2VzLmtleXMoKSkuZm9yRWFjaChpbWFnZSA9PiAodGhpcy5fZGlzdGFuY2VTY3JvbGxlZCA+PSB0aGlzLl9kaXN0YW5jZXMuZ2V0KGltYWdlKS5vZmZzZXRUb3ApICYmIHRoaXMuX2xvYWRJbWFnZShpbWFnZSkpO1xuICAgIH1cblxuICAgIF9nZXRBbGxFbGVtZW50T2Zmc2V0cygpe1xuICAgICAgICB0aGlzLl9kaXN0YW5jZXMgPSB0aGlzLl9pbWFnZXMucmVkdWNlKChpbWFnZXMsIGltYWdlKSA9PiB7XG5cbiAgICAgICAgICAgIGlmIChpbWFnZXMuaGFzKGltYWdlKSAmJiAhaW1hZ2VzLmdldChpbWFnZSkuaXNMb2FkaW5nKVxuICAgICAgICAgICAgICAgIHJldHVybiBpbWFnZXM7XG5cbiAgICAgICAgICAgIGltYWdlcy5zZXQoaW1hZ2UsIHtcbiAgICAgICAgICAgICAgICBvZmZzZXRUb3A6IG9mZnNldChpbWFnZSkudG9wLFxuICAgICAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGltZU91dDogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBpbWFnZXM7XG4gICAgICAgIH0sIHRoaXMuX2Rpc3RhbmNlcyB8fCBuZXcgTWFwKCkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBfZ2V0U2Nyb2xsZWRIZWlnaHQoKXtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodCArIHdpbmRvdy5zY3JvbGxZO1xuICAgIH1cblxuICAgIF9zY3JvbGxSZXNpemVIYW5kbGVyKGUpe1xuICAgICAgICBsZXQgZGlzdGFuY2UgPSB0aGlzLl9nZXRTY3JvbGxlZEhlaWdodCgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGRpc3RhbmNlIDw9IHRoaXMuX2Rpc3RhbmNlU2Nyb2xsZWQpIHJldHVybjtcblxuICAgICAgICB0aGlzLl9kaXN0YW5jZVNjcm9sbGVkID0gZGlzdGFuY2U7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpe1xuICAgICAgICB0aGlzLl9kb2MucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5fb25TY3JvbGxIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5fZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuX29uUmVzaXplSGFuZGxlcik7XG4gICAgfVxufVxuXG4iLCJpbXBvcnQgTGF6eUxvYWQgZnJvbSAnLi4vc3JjJztcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGUgPT4ge1xuICAgIGxldCBsYXp5ID0gbmV3IExhenlMb2FkKCk7XG59KTsiXX0=
